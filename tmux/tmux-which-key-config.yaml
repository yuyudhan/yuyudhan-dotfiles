# yaml-language-server: $schema=config.schema.yaml
# Tmux Which-Key Configuration for Ctrl+O Prefix
# This config matches the MODAL SYSTEM defined in tmux.conf
# All operations now require mode entry: C-o [mode-letter] [action]

command_alias_start_index: 200

keybindings:
  prefix_table: "?"

title:
  style: align=centre,bold
  prefix: "tmux @ modal help"
  prefix_style: fg=#7aa2f7,align=centre,bold

position:
  x: C
  y: C

items:
  # === MODAL SYSTEM ===
  # Navigation: C-h/j/k/l (No prefix - seamless vim integration)

  - name: "+Pane Mode (p) ğŸŸ¦"
    key: p
    menu:
      - name: "Split 50/50 horizontal (s)"
        key: s
        command: split-window -h -c "#{pane_current_path}"
      - name: "Split 50/50 vertical (v)"
        key: v
        command: split-window -v -c "#{pane_current_path}"
      - name: "Smart split 30/70 H (S)"
        key: S
        command: split-window -h -p 30 -c "#{pane_current_path}"
      - name: "Smart split 30/70 V (V)"
        key: V
        command: split-window -v -p 30 -c "#{pane_current_path}"
      - separator: true
      - name: "Create 2 equal panes (2)"
        key: "2"
        command: run-shell "~/.config/tmux/scripts/create-equal-panes.sh 2"
      - name: "Create 3 equal panes (3)"
        key: "3"
        command: run-shell "~/.config/tmux/scripts/create-equal-panes.sh 3"
      - name: "Create 4 equal panes (4)"
        key: "4"
        command: run-shell "~/.config/tmux/scripts/create-equal-panes.sh 4"
      - name: "Create 5 equal panes (5)"
        key: "5"
        command: run-shell "~/.config/tmux/scripts/create-equal-panes.sh 5"
      - name: "Equalize existing panes (e)"
        key: e
        command: select-layout even-horizontal
      - separator: true
      - name: "Resize left (H) â†”"
        key: H
        command: resize-pane -L 4
        transient: true
      - name: "Resize down (J) â†•"
        key: J
        command: resize-pane -D 4
        transient: true
      - name: "Resize up (K) â†•"
        key: K
        command: resize-pane -U 4
        transient: true
      - name: "Resize right (L) â†”"
        key: L
        command: resize-pane -R 4
        transient: true
      - separator: true
      - name: "Swap pane left (h) â†”"
        key: h
        command: swap-pane -L
      - name: "Swap pane down (j) â†•"
        key: j
        command: swap-pane -D
      - name: "Swap pane up (k) â†•"
        key: k
        command: swap-pane -U
      - name: "Swap pane right (l) â†”"
        key: l
        command: swap-pane -R
      - separator: true
      - name: "Break to window (!)"
        key: "!"
        command: break-pane
      - name: "Join window as pane (@)"
        key: "@"
        command: choose-window 'join-pane -h -s "%%"'
      - separator: true
      - name: "Rotate panes (r)"
        key: r
        command: rotate-window
      - separator: true
      - name: "Mark pane (m)"
        key: m
        command: select-pane -m
      - name: "Clear mark (M)"
        key: M
        command: select-pane -M
      - name: "Jump to marked (')"
        key: "'"
        command: switch-client -t'{marked}'
      - separator: true
      - name: "Clear + history (C)"
        key: C
        command: send-keys -R C-l \; clear-history
      - name: "Toggle broadcast sync (b) ğŸ”´"
        key: b
        command: set-window-option synchronize-panes\; if-shell '[ "#{pane_synchronized}" = "1" ]' 'set -g pane-active-border-style "fg=#f7768e,bg=#1a1b26,bold"' 'set -g pane-active-border-style "fg=#3d59a1,bg=#1a1b26,bold"' \; display-message "Sync #{?pane_synchronized,ON,OFF}"
      - name: "Toggle zoom (z) ğŸ”"
        key: z
        command: resize-pane -Z

  - name: "+Window Mode (w) ğŸŸ©"
    key: w
    menu:
      - name: "Fuzzy window selector (w)"
        key: w
        command: display-popup -E "tmux list-windows -a -F '#{session_name}:#{window_index}:#{window_name}' | fzf --reverse | sed 's/\\(.*\\):\\(.*\\):.*/\\1:\\2/' | xargs -I{} tmux switch-client -t {}"
      - separator: true
      - name: "Swap window left (h) â†”"
        key: h
        command: swap-window -t -1\; select-window -t -1
        transient: true
      - name: "Swap window right (l) â†”"
        key: l
        command: swap-window -t +1\; select-window -t +1
        transient: true
      - separator: true
      - name: "Even horizontal (1)"
        key: "1"
        command: select-layout even-horizontal
      - name: "Even vertical (2)"
        key: "2"
        command: select-layout even-vertical
      - name: "Main horizontal (3)"
        key: "3"
        command: select-layout main-horizontal
      - name: "Main vertical (4)"
        key: "4"
        command: select-layout main-vertical
      - name: "Tiled (5)"
        key: "5"
        command: select-layout tiled

  - name: "+Session Mode (o) ğŸŸª"
    key: o
    menu:
      - name: "tmux-sessionx (o)"
        key: o
        command: run-shell "~/.config/tmux/plugins/tmux-sessionx/sessionx.sh"
      - name: "Jump to last session (l)"
        key: l
        command: switch-client -l
      - name: "Create project session (p)"
        key: p
        command: display-popup -E -w80% -h80% "~/.config/tmux/scripts/new-project-session.sh"
      - name: "Quick save (s) ğŸ’¾"
        key: s
        command: run-shell "~/.config/tmux/plugins/tmux-resurrect/scripts/save.sh" \; display-message "ğŸ’¾ Session saved!"
      - name: "Save and detach (d) ğŸ’¾"
        key: d
        command: run-shell "~/.config/tmux/plugins/tmux-resurrect/scripts/save.sh" \; detach-client \; display-message "ğŸ’¾ Saved and detached!"

  - name: "+Copy Mode (c) ğŸŸ¨"
    key: c
    menu:
      - name: "Enter copy mode (c)"
        key: c
        command: copy-mode
      - name: "tmux-thumbs selection (t)"
        key: t
        command: run-shell "~/.config/tmux/plugins/tmux-thumbs/tmux-thumbs.sh"
      - name: "Extract & open URLs (u)"
        key: u
        command: run-shell "~/.config/tmux/plugins/tmux-fzf-url/fzf-url.sh"

  - name: "+Search Mode (/) ğŸŸ¨"
    key: /
    menu:
      - name: "Regex search (/)"
        key: /
        command: copy-mode \; send-keys /
      - name: "File search (f)"
        key: f
        command: copy-mode \; run-shell "~/.config/tmux/plugins/tmux-copycat/scripts/copycat_search.sh [[:alnum:]_\\./~-]*"
      - name: "Git files search (g)"
        key: g
        command: copy-mode \; run-shell "~/.config/tmux/plugins/tmux-copycat/scripts/copycat_git_special.sh"
      - name: "URL search (u)"
        key: u
        command: copy-mode \; run-shell "~/.config/tmux/plugins/tmux-copycat/scripts/copycat_search.sh ((https?://|git@|git://|ssh://|ftp://|file:///)[[:alnum:]?=%/_.:,;~@!#$&()*+-]*)"
      - name: "Digit search (d)"
        key: d
        command: copy-mode \; run-shell "~/.config/tmux/plugins/tmux-copycat/scripts/copycat_search.sh [[:digit:]]+"
      - name: "Hash search (h)"
        key: h
        command: copy-mode \; run-shell "~/.config/tmux/plugins/tmux-copycat/scripts/copycat_search.sh \\b([0-9a-f]{7,40}|[[:alnum:]]{52}|[0-9a-f]{64})\\b"

  - name: "+Git Mode (g) ğŸŸ§"
    key: g
    menu:
      - name: "Git log popup (l)"
        key: l
        command: display-popup -E -w80% -h80% -d "#{pane_current_path}" "git log --oneline --graph --all --decorate"
      - name: "Git status popup (s)"
        key: s
        command: display-popup -E -w80% -h80% -d "#{pane_current_path}" "git status"
      - name: "Git diff popup (d)"
        key: d
        command: display-popup -E -w80% -h80% -d "#{pane_current_path}" "git diff"

  - name: "+Utility Mode (u) ğŸ©µ"
    key: u
    menu:
      - name: "tmux-fzf comprehensive menu (f)"
        key: f
        command: run-shell -b "~/.config/tmux/plugins/tmux-fzf/main.sh"
      - name: "Man page popup (m)"
        key: m
        command: command-prompt -p "man page:" "display-popup -E -w80% -h80% 'man %%'"
      - name: "Edit tmux config (e)"
        key: e
        command: new-window -n "tmux.conf" "nvim ~/.config/tmux/tmux.conf"

  - separator: true

  # === CREATE/RENAME/KILL/SWITCH MODES (Existing - Already Aligned) ===
  - name: "+Create Mode (a) ğŸ©µ"
    key: a
    menu:
      - name: "New pane (p)"
        key: p
        command: command-prompt -p "New pane name:" "split-window -v -c '#{pane_current_path}'; select-pane -T '%%'"
      - name: "New window (w)"
        key: w
        command: command-prompt -p "New window name:" "new-window -c '#{pane_current_path}' -n '%%'"
      - name: "New session (s)"
        key: s
        command: command-prompt -p "New session name:" "new-session -s '%%'"

  - name: "+Rename Mode (r) ğŸ©µ"
    key: r
    menu:
      - name: "Rename session (s)"
        key: s
        command: command-prompt -p "Rename session:" "rename-session '%%'"
      - name: "Rename window (w)"
        key: w
        command: command-prompt -p "Rename window:" "rename-window '%%'"
      - name: "Rename pane (p)"
        key: p
        command: command-prompt -p "Rename pane:" "select-pane -T '%%'"

  - name: "+Kill Mode (x) ğŸŸ¥"
    key: x
    menu:
      - name: "Kill pane (p)"
        key: p
        command: 'confirm-before -p "Kill pane? (y/n)" kill-pane'
      - name: "Kill window (w)"
        key: w
        command: 'confirm-before -p "Kill window? (y/n)" kill-window'
      - name: "Kill session (s)"
        key: s
        command: 'confirm-before -p "Kill session? (y/n)" kill-session'

  - name: "+Switch Mode (s) ğŸŸ¦"
    key: s
    menu:
      - name: "Choose window (w)"
        key: w
        command: choose-window
      - name: "Choose session (s)"
        key: s
        command: choose-session
      - name: "Choose tree (t)"
        key: t
        command: choose-tree

  - name: "+Tmux Mode (q) âš™ï¸"
    key: q
    menu:
      - name: "Detach client (D)"
        key: D
        command: detach-client
      - name: "Save session (S) ğŸ’¾"
        key: S
        command: run-shell "~/.config/tmux/plugins/tmux-resurrect/scripts/save.sh" \; display-message "Session saved âœ…"
      - name: "Restore session (R) ğŸ’¾"
        key: R
        command: run-shell "~/.config/tmux/plugins/tmux-resurrect/scripts/restore.sh" \; display-message "Session restored âœ…"
      - name: "Install plugins (I)"
        key: I
        command: run-shell '~/.config/tmux/plugins/tpm/bin/install_plugins' \; display-message "Installing TPM Plugins..."
      - name: "Reload config (C) â™»ï¸"
        key: C
        command: source-file ~/.config/tmux/tmux.conf \; display-message "Config reloaded! âœ…"
      - name: "Popup terminal (p)"
        key: p
        command: display-popup -E -w80% -h80%

  - separator: true

  # === VISUAL INDICATORS REFERENCE ===
  - name: "ğŸ“Š Visual Indicators Help"
    key: i
    menu:
      - name: "Status Bar Mode Colors:"
        key: null
      - name: "  PANE (Blue) ğŸŸ¦ | WINDOW (Green) ğŸŸ© | SESSION (Purple) ğŸŸª"
        key: null
      - name: "  COPY/SEARCH (Yellow) ğŸŸ¨ | GIT (Orange) ğŸŸ§ | UTIL (Cyan) ğŸ©µ"
        key: null
      - name: "  CREATE (Teal) ğŸ©µ | RENAME (Light Blue) ğŸ©µ | KILL (Red) ğŸŸ¥"
        key: null
      - separator: true
      - name: "Pane Border States:"
        key: null
      - name: "  Blue = Normal | Red = Synchronized ğŸ”´ | ğŸ” = Zoomed"
        key: null
      - separator: true
      - name: "Navigation (No Prefix!):"
        key: null
      - name: "  C-h/j/k/l = Seamless vim-style navigation"
        key: null

  - separator: true

  # === MISC ===
  - name: "Show default keybindings (?)"
    key: "?"
    command: list-keys -N

  - name: "Clock mode (T)"
    key: T
    command: clock-mode

  - name: "Show messages (~)"
    key: "~"
    command: show-messages
